/*!  2017-04-14 */
try{!function(){function a(){}a.prototype.init=function(){this.bind("click.pay-way",".pay-way",this.togglePayQuestion),this.bind("click.pays",".pay_problem_close,.in_pay_button_r",this.togglePayQuestion),this.bind("click.pays","[data-bank-display]",this.showMoreBanks),this.bind("click.pays",".look_pay",this.showOrders),this.initActivePay()},a.prototype.initActivePay=function(){var a=new Lsmain.UrlParserClass(location.href).paras.from;if("quickpay"==a)$(".tabs span[data-id=8]").click();else{$(".tabs .tab:eq(0)").addClass("current");var b=$(".tabs .tab:eq(0)").data("target");$(b).addClass("current")}},a.prototype.showPayQuestion=function(){this.visiblePayQuestion(!0)},a.prototype.togglePayQuestion=function(a){var b=$(a.currentTarget).hasClass("pay-way");$("#lsMark,.pay_problem")[b?"show":"hide"]()},a.prototype.showMoreBanks=function(a){var b=$(a.currentTarget),c=b.closest(".pay-inner");c.find(".more").removeClass("hide"),b.remove()},a.prototype.showOrders=function(){$(".success_pay_main").toggle(),$(ev.currentTarget).children("i").toggleClass("cur")},LsPageClass.run(a)}(),function(){function a(){}var b=$("#offlinePay");Lsmain;a.prototype.validationModel={credentialPics:{minlength:[1,"璇蜂笂浼犳偍鐨勬眹娆惧嚟璇併€�"]},remitter:{required:"璇峰～鍐欐眹娆句汉璐︽埛鍚嶇О銆�",maxlength:[30,"姹囨浜洪暱搴︿笉鑳借秴杩噞0}涓瓧绗�"]},bankSeq:{maxlength:[30,"姹囨鏃堕棿闀垮害涓嶈兘瓒呰繃{0}涓瓧绗�"]}},a.prototype.init=function(){this.initClip(),this.initHandler(),this.setSlient(!0),this.registerUploadCall("uploadCredential",this.uploadCredential),this.registerUploadCall("updateCredentialPic",this.updateCredentialPic)},a.prototype.initHandler=function(){this.bind("click.offline",".pay-offline-btn",this.goOfflinePay),this.bind("click.offline",".btn-submit-credential",this.submitCredential),this.bind("click.offline",".credential-box .remove",this.doRemoveCredentialPic),$(document.body).on("click.offline","[data-id=5]",this.doCall(this.initBackOfflinePay))},a.prototype.initClip=function(){var a=new Clipboard(".btn-copy");a.on("success",function(a){Lsmain.tip.success("澶嶅埗鎴愬姛!"),a.clearSelection()}),a.on("error",function(a){var b=$(a.trigger);messager.prompt("娴忚鍣ㄤ笉鏀寔鑷姩澶嶅埗 璇锋墜鍔ㄥ鍒�"+b.data("clipboardName"),"澶嶅埗璐︽埛",b.data("clipboardText"))})},a.prototype.initBackOfflinePay=function(){$(document.body).off("click.offline"),this.isBackOffline="true"==$("#isBackOffline").val();var a=$("#tradeIds").val();this.isBackOffline&&this.post("/pay/get-offline-pay-info",{tradeId:a}).complete(this.doCall(this.doFillBackOffline))},a.prototype.doFillBackOffline=function(a,b){if(b=a||b,0==b.code){var c=b.data.data;this.fill(c);for(var d=c.imgPaths||[],e=0,f=d.length;f>e;e++){var g=d[e];""!=(g||"").replace(/\s/g,"")&&this.uploadCredential(g)}}},a.prototype.submitCredential=function(){var a=this.read();this.yesValidation(a)?(b.find("#imgPath").val(JSON.stringify(a.credentialPics)),this.lock(this.submitCredential),this.doLoading(".btn-submit-credential"),$("#offlineSubmitForm").submit()):messager.alert(this.getValidationMessage())},a.prototype.submitCredentialComplete=function(a,b){b=a||b,this.doLoadEnd(".btn-submit-credential"),this.unLock(this.submitCredential),200==b.code?location.href=b.goUrl:this.error(b.message)},a.prototype.uploadCredential=function(a,c,d){var e=b.find(".credential-imglist"),f=$(b.find("#credentialPicTmpl").html());f.find("img").attr("src",a),e.append(f),this.refreshButton()},a.prototype.updateCredentialPic=function(a,b,c){$(c).closest(".credential-box").find("img").attr("src",a)},a.prototype.doRemoveCredentialPic=function(a){$(a.srcElement||a.target).closest(".credential-box").remove(),this.refreshButton()},a.prototype.refreshButton=function(){var a=b.find(".credential-imglist"),c=a.find("img").length;b.find(".credential-upload")[3>c?"show":"hide"](),b.find(".credential-imglist")[c>0?"show":"hide"]()},a.prototype.goOfflinePay=function(){$("#offlinepayOne").hide(),$("#offlinepayTwo").show()},LsPageClass.run(a,b)}(),function(){function a(){var a=c;c=$.extend({},a),c.needSendSMS="0"!=c.needSendSMS;"true"==$("#needSetPassword").val();this.hasToken=""!=Lsmain.utils.ifn(c.payToken,""),b.DataValidator.registerRule("effectiveTime",this.effectiveTime,"鏃犳晥鐨勬湁鏁堟湡")}var b=Lsmain,c=new Lsmain.CookieParser(document.cookie);a.prototype.effectiveTime=function(a){a=a||"";var b=!1;if(4==a.length){var c=Number(a[0]+a[1]),d=Number(a[2]+a[3]);b=c>0&&12>=c&&d>0}return b},a.prototype.bankValidationModel={bankno:{required:"閾惰鍗″彿蹇呴』濉啓"},name:{required:"濮撳悕涓嶈兘涓虹┖"},idCardNo:{required:"韬唤璇佸彿涓嶈兘涓虹┖",idCard:"璇疯緭鍏ユ纭殑韬唤璇佸彿鐮�"},phoneNo:{required:"璇疯緭鍏ユ墜鏈哄彿"}},a.prototype.creditCardValidationModel=$.extend({effectiveTime:{required:"鏈夋晥鏈熶笉鑳戒负绌�",effectiveTime:"淇＄敤鍗℃湁鏁堟湡鏍煎紡涓� xx鏈�/xx骞� 渚嬪锛�0720"},safeCode:{required:"瀹夊叏鐮佷笉鑳戒负绌�"}},a.prototype.bankValidationModel),a.prototype.init=function(){this.validationModel=this.bankValidationModel,this.inBankNo(),this.sendBankSms(),this.bindNextPay(),this.viewBankCards(),this.chooseCard(),this.otherBankCard(),this.bankListFirstClick()},a.prototype.bankListFirstClick=function(){$(".bind-card-two .bank-list.enable").eq(0).click()},a.prototype.inBankNo=function(){var a=this;$("#bank-num input").blur(function(){var b=$(this);if(""!=b.val()){var c={cardNumber:$(this).val().replace(/\s/g,""),tradeAmount:$(".success_pay_total em").html().substring(1)};$.post("/pay/quickpay/bind_card/check",c,function(c){if(200==c.code){var d=c.data.authorize,e=c.data.bankCode;$(".mobileCheck").removeClass("disabled"),d&&(delete a.creditCardValidationModel.name,delete a.creditCardValidationModel.idCardNo,delete a.validationModel.idCardNo,delete a.validationModel.name,$("#bindCardTwice .error").removeClass("error"),$(".validation.tooltip").hide(),$("input[name=name]").val(c.data.userRealName).attr("disabled","disabled"),$("input[name=idCardNo]").val(c.data.userIdCard).attr("disabled","disabled")),null!=e?bankUrl=e.toLowerCase():bankUrl="default",b.siblings(".error-mess-num").addClass("none"),$("#bank-pay,#card-type").removeClass("none"),$("#effective-time,[name=safeCode],[name=verifyCode]").val(""),$("#card-type .backcard-name").html(c.data.cardTypeName),$("#bank-pay .bank-logo").attr("src",Lsmain.config.urlJoin("f2e-framework.cdnUrl","resources/images/bank/"+bankUrl+".jpg")),$("#ammountLimit").html(c.data.ammountLimit),$("#bankCardType").val(c.data.cardTypeId),2==c.data.cardTypeId?(a.validationModel=a.creditCardValidationModel,$(".credit-remind,#effective-date,#safe-code").removeClass("none"),$("#effective-time").focus()):1==c.data.cardTypeId&&$(".credit-remind,#effective-date,#safe-code").addClass("none")}else $(".mobileCheck").addClass("disabled"),messager.error(c.message)},"json")}})},a.prototype.sendBankSms=function(){$(".mobileCheck").sms({simple:!0,inCls:"crm_sms_sending",sendUrl:"/pay/quickpay/bind_card/send_validation_code",formatter:function(a){var b=null,c=null;return"2"==$("#bankCardType").val()&&(b=$(".bind-card ").find("input[name = 'safeCode']").val().replace(/\s/g,""),c=$("#effective-time").val()),{uuid:a.uuid,cardNumber:$("#bank-num").find("input[name = 'bankno']").val().replace(/\s/g,""),cardType:$("#bankCardType").val(),mobile:$.trim($("#phone-num").val()),cvv2:b,expiredDate:c,userRealName:$(".bind-card ").find("input[name = 'name']").val().replace(/\s/g,""),idCard:$(".bind-card ").find("input[name = 'idCardNo']").val().replace(/\s/g,"")}},callback:function(a){$("#bindIdFirst").val(a.data.bindId),$("#next-pay").removeClass("disabled")},getHandler:function(){return $(this).hasClass("disabled")?void 0:{data:{mobiles:$.trim($("#phone-num").val())}}}})},a.prototype.bindNextPay=function(){var a=this,b=!1;$(".next-pay").click(function(){if(!b&&!$(this).hasClass("disabled")){var d=a.read("#bindCardTwice");if(a.yesValidation(d)){b=!0;var e={bindId:$("#bindIdFirst").val(),validationCode:$(".bind-card ").find("input[name = 'verifyCode']").val()};$.post("/pay/quickpay/bind_card/check_validation_code",e,function(a){if("200"==a.code){var d=a.data,e=Lsmain.date.addMinutes(new Date,10);c.setCookie("bindId",d.bindId,e,"/"),c.setCookie("payToken",d.payToken,e,"/"),c.setCookie("needSendSMS",d.needSendSMS?1:0,e,"/"),location.href=location.href+"&from=quickpay"}else messager.error(a.message).addListener("closed",function(){b=!1})},"json")}}})},$(".forget-text").bind("click",function(){c.setCookie("payOrderHref",location.href,null,"/")}),a.prototype.viewBankCards=function(){$(".view-banks").on("click",function(){$(".bank-cards-box,#lsMark").removeClass("none"),$("body").css("overflow-y","hidden"),$(".bank-cards-box .bank-card-tab").find("span").eq(0).click()}),$(".icon-close").on("click",function(){$(".bank-cards-box,#lsMark").addClass("none"),$("body").css("overflow-y","visible")})},a.prototype.chooseCard=function(){$(".bind-card-two").on("click",".bank-list.enable",function(){var a=c.needSendSMS;1==$(".bank-list.enable").length&&3==$("#errorCode").val()?($("#pay-phone-num").removeClass("none"),$("#pay-phone-num input").removeClass("none")):a?($("#pay-phone-num").removeClass("none"),$("#pay-phone-num input").removeClass("none")):($("#pay-phone-num").addClass("none"),$("#pay-phone-num input").addClass("none")),$(".phoneCode").html($(this).attr("data-mobile")),$(this).addClass("current-border").siblings().removeClass("current-border"),$(this).find($("input[name='bank-list']")).attr("checked","checked"),$(".other-bank").removeClass("none"),$(".codeMobileNum1,.codeMobileNum2,.pass_back_button").removeClass("none"),$(".bank-con").addClass("none"),$("#bindCardTwice").addClass("none")})},a.prototype.otherBankCard=function(){$(".other-bank").on("click",function(){$(this).addClass("none"),$(".codeMobileNum1,.codeMobileNum2,.pass_back_button").addClass("none"),$("#bindCardTwice").removeClass("none"),$(".bank-list.enable").removeClass("current-border").find($("input[name='bank-list']")).attr("checked",!1)})},a.prototype.agreeQuickPayPro=function(){$(".check-agree").click(function(){$(this).toggleClass("check-agreed"),$(this).is(".check-agreed")?$("#btnPayNow").removeClass("disabled"):$("#btnPayNow").addClass("disabled")})},LsPageClass.run(a,$("#bindCardTwice"))}(),function(){function a(){var a=b;b=$.extend({},a),b.needSendSMS="0"!=b.needSendSMS,this.hasToken=""!=Lsmain.utils.ifn(b.payToken,""),this.isBankNeedSendSms="true"==$("#isBankNeedSendSms").val(),this.tradeIds=$("#tradeIds").val(),this.payToken=b.payToken,this.isFirstBindCardAndNoSms=this.hasToken&&!b.needSendSMS,a.removeCookie("bindId","/"),a.removeCookie("payToken","/"),a.removeCookie("needSendSMS","/")}var b=(Lsmain,new Lsmain.CookieParser(document.cookie));a.prototype.PayPasswordValidation={payCode:{required:"璇疯緭鍏ョ煭淇￠獙璇佺爜"},password:{required:"璇疯緭鍏ュ瘑鐮�"},rePassword:{required:"璇疯緭鍏ョ‘璁ゅ瘑鐮�",equalTo:["password","涓ゆ瀵嗙爜涓嶄竴鑷�"]}},a.prototype.payRePasswordSmsValidation={payCode:{required:"璇疯緭鍏ョ煭淇￠獙璇佺爜"},password:{required:"璇疯緭鍏ュ瘑鐮�"},rePassword:{required:"璇疯緭鍏ョ‘璁ゅ瘑鐮�",equalTo:["password","涓ゆ瀵嗙爜涓嶄竴鑷�"]}},a.prototype.payPasswordSmsValidation={payCode:{required:"璇疯緭鍏ョ煭淇￠獙璇佺爜"},password:{required:"璇疯緭鍏ュ瘑鐮�"}},a.prototype.init=function(){this.initValidationModel(),this.bind("click.setPasswrod","#btnGoPay",this.doSubmitSetPasswordAndPay),this.bind("click.pay","#btnPayNow",this.doSubmitPay),this.bind("click.sms","#getCodeNum,#getCodeNumFirst",this.doSendValidationCode),this.agreeQuickPayPro()},a.prototype.initValidationModel=function(){var a=b.needSendSMS,c="true"==$("#needSetPassword").val(),d=null;c?d=this.isBankNeedSendSms?this.payRePasswordSmsValidation:this.PayPasswordValidation:(d=this.payPasswordSmsValidation,a||delete d.payCode),this.validationModel=d,a||$("#btnGoPay,#btnPayNow").removeClass("disabled")},a.prototype.onInvalid=function(a,b){b.closest("div").find(".required.middle").remove(),b.closest("div").append('<span class="required middle">'+a+"</span>")},a.prototype.onValid=function(a){a.closest("div").find(".required.middle").remove()},a.prototype.doSubmitPay=function(){var a=this.read("#quickPayForm");a.paymentId=this.paymentId,this.yesValidation(a)&&(this.lock(this.doSubmitPay),$("#btnPayNow").val("璇风◢鍚�..."),this.isFirstBindCardAndNoSms?this.doSubmitPayWhenFirstNoSms(a):this.doSubmitPayByPassword(a))},a.prototype.doSubmitSetPasswordAndPay=function(){var a=this.read("#setPasswordForm");if(a.paymentId=this.paymentId,this.yesValidation(a)){if(!this.checkPassword())return;$("#btnGoPay").val("璇风◢鍚�...");var b={paymentId:this.paymentId,payPassword:a.password,validateCode:a.payCode};this.lock(this.doSubmitPay),this.post("/pay/quickpay/pay/check_quickpay_code",b).complete(this.doCall(this.doSubmitPayComplete))}},a.prototype.doSubmitPayByPassword=function(a){var b={paymentId:this.paymentId,payPassword:a.password,validateCode:a.payCode};this.post("/pay/quickpay/pay/check_quickpay_code",b).complete(this.doCall(this.doSubmitPayComplete))},a.prototype.doSubmitPayWhenFirstNoSms=function(a){var c={bindId:b.bindId||$(".bank-list.current-border").attr("data-id"),tradeIds:this.tradeIds,payToken:this.payToken,payPassword:a.password};this.post("/pay/quickpay/pay/confirm_quick_pay",c).complete(this.doCall(this.doSubmitPayComplete))},a.prototype.doSendValidationCode=function(){var a={tradeIds:this.tradeIds,bindId:this.hasToken?b.bindId:$(".bank-list.current-border").attr("data-id")};$("#getCodeNum").html("璇风◢鍚�..."),this.lock(this.doSendValidationCode),this.post("/pay/quickpay/pay/send_quickpay_code",a).complete(this.doCall(this.doSendValidationCodeComplete))},a.prototype.doSendValidationCodeComplete=function(a,b){if(b=a||b,200!=b.code)return this.unLock(this.doSendValidationCode),$("#getCodeNum").html("閲嶆柊鑾峰彇"),messager.error(b.message);this.paymentId=b.data.paymentId,$("#btnGoPay,#btnPayNow").removeClass("disabled");var c=Lsmain,d=c.Timer.counter(60),e=this,f=$("#getCodeNum");d.iterator(function(a){f.html(c.string.format("杩樺墿{0}绉�",a))}).complete(function(){f.html("閲嶆柊鑾峰彇"),e.unLock(e.doSendValidationCode),e=f=null}).start()},a.prototype.doSubmitPayComplete=function(a,b){return b=a||b,200!=b.code?($("#btnGoPay").val("閲嶆柊鏀粯"),$("#btnPayNow").val("纭浠樻"),this.unLock(this.doSubmitPay),messager.error(b.message)):void(location.href=b.data.goUrl)},a.prototype.agreeQuickPayPro=function(){$(".check-agree").click(function(){$(this).toggleClass("check-agreed"),$(this).is(".check-agreed")?$("#btnPayNow").removeClass("disabled"):$("#btnPayNow").addClass("disabled")})},a.prototype.checkPassword=function(){var a=$("#setPassword");if("false"==a.attr("checkrlt")){var b=a.closest(".password-right").find(".warnMsgDiv").html();return messager.error(b),this.messageMessage=null,!1}return!0},LsPageClass.run(a)}()}catch(ex){window.console&&console.error(ex),window.BJ_REPORT&&BJ_REPORT.report(ex)}